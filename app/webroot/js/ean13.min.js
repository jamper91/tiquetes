/*
* Copyright (c) 2014 Johannes Mittendorfer (http://johannes-mittendorfer.com)
* Licensed under the MIT License (LICENSE.txt).
*
* Version 2.1.2
* Build 2014-11-08
*/

var EAN13,pluginName;pluginName=null,EAN13=function(){function a(a,b,c){var d;if(this.element=a,this.number=b,this.settings={number:!0,prefix:!0,color:"#000",debug:!1,onValid:function(){},onInvalid:function(){},onSuccess:function(){},onError:function(){}},c)for(d in c)this.settings[d]=c[d];this._name=pluginName,this.init()}return a.prototype.settings={},a.prototype.init=function(){var a,b;return 12===this.number.length&&(a=this.generateCheckDigit(this.number),this.number+=a),13===this.number.length?(this.validate()?this.settings.onValid.call():this.settings.onInvalid.call(),b=this.getCode(),this.draw(b)):this.settings.onError.call()},a.prototype.getCode=function(){var a,b,c,d,e,f,g,h,i;for(g=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],h=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],i=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],c=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"],b="",a=c[parseInt(this.number.substr(0,1),10)].split(""),f=this.number.substr(1),e=f.split(""),d=0;6>d;)b+="x"===a[d]?g[e[d]]:h[e[d]],d++;for(d=6;12>d;)b+=i[e[d]],d++;return b},a.prototype.clear=function(a){return a.clearRect(0,0,this.element.width,this.element.height)},a.prototype.draw=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(i={prefix_offset:.06,font_stretch:.073,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.15,font_y:1.03,text_offset:4.5},o=this.settings.prefix?this.element.width-this.element.width*i.prefix_offset:this.element.width,this.settings.number?(b=i.border_line_height_number*this.element.height,e=i.line_height*b):(b=i.border_line_height*this.element.height,e=b),g=o/95,this.element.getContext){for(d=this.element.getContext("2d"),this.clear(d),d.fillStyle=this.settings.color,j=this.settings.number&&this.settings.prefix?this.element.width*i.prefix_offset:0,k=a.split(""),d.fillRect(j,0,g,b),j+=2*g,d.fillRect(j,0,g,b),j+=g,f=0;42>f;)"1"===k[f]&&d.fillRect(j,0,Math.floor(g)+1,e),j+=g,f++;for(j+=g,d.fillRect(j,0,g,b),j+=2*g,d.fillRect(j,0,g,b),j+=2*g,f=42;84>f;)"1"===k[f]&&d.fillRect(j,0,Math.floor(g)+1,e),j+=g,f++;if(d.fillRect(j,0,g,b),j+=2*g,d.fillRect(j,0,g,b),this.settings.number){for(d.font=i.font_size*e+"px monospace",m=this.number.substr(0,1),this.settings.prefix&&d.fillText(m,0,b*i.font_y),l=g*i.text_offset+(this.settings.prefix?i.prefix_offset*this.element.width:0),c=this.number.substr(1,6).split(""),h=q=0,t=c.length;t>q;h=++q)n=c[h],d.fillText(n,l,b*i.font_y),l+=i.font_stretch*o;for(l=49*g+(this.settings.prefix?i.prefix_offset*this.element.width:0)+i.text_offset,v=this.number.substr(7).split(""),h=r=0,u=v.length;u>r;h=++r)n=v[h],d.fillText(n,l,b*i.font_y),l+=i.font_stretch*o}if(this.settings.debug)for(p=s=0,w=2*g;w>0?o>=s:s>=o;p=s+=w)d.beginPath(),d.rect(p,.4*e,g,.1*e),d.fillStyle="red",d.fill();return this.settings.onSuccess.call()}return this.settings.onError.call()},a.prototype.generateCheckDigit=function(a){var b,c,d,e,f,g;for(c=0,b=a.split(""),d=f=0,g=b.length;g>f;d=++f)e=b[d],c+=d%2===0?parseInt(e,10):3*parseInt(e,10);return 10-c%10%10},a.prototype.validate=function(){return parseInt(this.number.slice(-1),10)===this.generateCheckDigit(this.number.slice(0,-1))},a}(),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=EAN13);